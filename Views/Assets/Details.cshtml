@model Asset.Models.hdAssets

@{
    ViewData["Title"] = "Asset Details";
    var warrantyDaysLeft = Model.WarrantyExpirationDate.HasValue ?
        (Model.WarrantyExpirationDate.Value - DateTime.Now).Days : 0;
    var warrantyStatus = warrantyDaysLeft <= 0 ? "expired" :
        warrantyDaysLeft <= 90 ? "expiring" : "active";
}

<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a asp-action="Index">Assets</a></li>
                    <li class="breadcrumb-item active">@Model.ComputerName</li>
                </ol>
            </nav>
        </div>
    </div>

    <!-- Asset Header Card -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-6 fw-bold text-primary mb-2">
                        <i class="bi bi-laptop me-2"></i>@Model.ComputerName
                    </h1>
                    <div class="d-flex flex-wrap gap-2 mb-3">
                        <span class="badge bg-primary fs-6">
                            <i class="bi bi-tag me-1"></i>@Model.hdAssetTypes?.Name
                        </span>
                        @{
                            var statusBadge = Model.Status?.StatusId switch
                            {
                                1 => "bg-success",
                                2 => "bg-danger",
                                3 => "bg-warning",
                                _ => "bg-secondary"
                            };
                        }
                        <span class="badge @statusBadge fs-6">
                            <i class="bi bi-circle-fill me-1"></i>@Model.Status?.Name
                        </span>
                        @if (warrantyStatus == "expiring")
                        {
                            <span class="badge bg-warning text-dark fs-6">
                                <i class="bi bi-exclamation-triangle me-1"></i>Warranty Expiring Soon
                            </span>
                        }
                        else if (warrantyStatus == "expired")
                        {
                            <span class="badge bg-danger fs-6">
                                <i class="bi bi-x-circle me-1"></i>Warranty Expired
                            </span>
                        }
                    </div>
                    <p class="text-muted mb-0">
                        <i class="bi bi-person me-1"></i>
                        <strong>Assigned to:</strong> @Model.UserName
                    </p>
                </div>
                <div class="col-md-4 text-md-end mt-3 mt-md-0">
                    <div class="btn-group" role="group">
                        <a asp-action="Edit" asp-route-id="@Model.AssetID" class="btn btn-primary">
                            <i class="bi bi-pencil me-2"></i>Edit
                        </a>
                        <a asp-action="Index" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left me-2"></i>Back to List
                        </a>
                    </div>
                    <div class="mt-2">
                        <button class="btn btn-outline-danger btn-sm" onclick="if(confirm('Are you sure you want to delete this asset?')) window.location.href='@Url.Action("Delete", new { id = Model.AssetID })'">
                            <i class="bi bi-trash me-1"></i>Delete Asset
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Left Column -->
        <div class="col-lg-6">
            <!-- Basic Information -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-info-circle me-2"></i>Basic Information</h5>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-5 text-muted">Computer Name</dt>
                        <dd class="col-sm-7 fw-semibold">@Model.ComputerName</dd>

                        <dt class="col-sm-5 text-muted">Serial Number</dt>
                        <dd class="col-sm-7">
                            <code class="bg-light px-2 py-1 rounded">@Model.SerialNumber</code>
                        </dd>

                        <dt class="col-sm-5 text-muted">Asset Type</dt>
                        <dd class="col-sm-7">@Model.hdAssetTypes?.Name</dd>

                        <dt class="col-sm-5 text-muted">Manufacturer</dt>
                        <dd class="col-sm-7">@Model.Manufacturer</dd>

                        <dt class="col-sm-5 text-muted">Model</dt>
                        <dd class="col-sm-7">@Model.Model</dd>

                        <dt class="col-sm-5 text-muted">Supplier</dt>
                        <dd class="col-sm-7">@Model.Supplier</dd>
                    </dl>
                </div>
            </div>

            <!-- Technical Specifications -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-cpu me-2"></i>Technical Specifications</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="spec-item">
                                <div class="spec-icon bg-primary bg-opacity-10 text-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 40px; height: 40px;">
                                    <i class="bi bi-cpu"></i>
                                </div>
                                <div class="spec-label text-muted small">Processor</div>
                                <div class="spec-value fw-semibold">@(Model.Processor ?? "Not specified")</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="spec-item">
                                <div class="spec-icon bg-info bg-opacity-10 text-info rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 40px; height: 40px;">
                                    <i class="bi bi-memory"></i>
                                </div>
                                <div class="spec-label text-muted small">RAM</div>
                                <div class="spec-value fw-semibold">@(Model.RAM ?? "Not specified")</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="spec-item">
                                <div class="spec-icon bg-warning bg-opacity-10 text-warning rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 40px; height: 40px;">
                                    <i class="bi bi-device-hdd"></i>
                                </div>
                                <div class="spec-label text-muted small">Storage</div>
                                <div class="spec-value fw-semibold">@(Model.Storage ?? "Not specified")</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="spec-item">
                                <div class="spec-icon bg-success bg-opacity-10 text-success rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 40px; height: 40px;">
                                    <i class="bi bi-windows"></i>
                                </div>
                                <div class="spec-label text-muted small">Operating System</div>
                                <div class="spec-value fw-semibold">@(Model.OS ?? "Not specified")</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Peripherals -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-devices me-2"></i>Peripherals</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3 mb-md-0">
                            <div class="d-flex align-items-start">
                                <div class="me-3">
                                    <i class="bi bi-display fs-3 text-info"></i>
                                </div>
                                <div>
                                    <div class="fw-semibold">Monitor</div>
                                    <div class="text-muted">@(Model.Monitor ?? "Not connected")</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-start">
                                <div class="me-3">
                                    <i class="bi bi-printer fs-3 text-info"></i>
                                </div>
                                <div>
                                    <div class="fw-semibold">Printer</div>
                                    <div class="text-muted">@(Model.Printer ?? "Not connected")</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="col-lg-6">
            <!-- Purchase Information -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0"><i class="bi bi-cart me-2"></i>Purchase Information</h5>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-5 text-muted">Purchase Date</dt>
                        <dd class="col-sm-7 fw-semibold">
                            @if (Model.PurchaseDate != null)
                            {
                                <i class="bi bi-calendar3 me-1"></i>
                                @Model.PurchaseDate.ToString("MMMM dd, yyyy")
                            }
                            else
                            {
                                <span class="text-muted">Not recorded</span>
                            }
                        </dd>

                        <dt class="col-sm-5 text-muted">Purchase Price</dt>
                        <dd class="col-sm-7">
                            @if (Model.PurchasePrice.HasValue)
                            {
                                <span class="fs-5 fw-bold text-success">@Model.PurchasePrice.Value.ToString("C")</span>
                            }
                            else
                            {
                                <span class="text-muted">Not recorded</span>
                            }
                        </dd>

                        <dt class="col-sm-5 text-muted">Supplier</dt>
                        <dd class="col-sm-7">@(Model.Supplier ?? "Not specified")</dd>

                        <dt class="col-sm-5 text-muted">Age</dt>
                        <dd class="col-sm-7">
                            @if (Model.PurchaseDate != null)
                            {
                                var age = DateTime.Now - Model.PurchaseDate.Date;
                                var years = age.Days / 365;
                                var months = (age.Days % 365) / 30;
                                <span>@years year(s), @months month(s)</span>
                            }
                            else
                            {
                                <span class="text-muted">Unknown</span>
                            }
                        </dd>
                    </dl>
                </div>
            </div>

            <!-- Warranty Information -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header @(warrantyStatus == "expired" ? "bg-danger text-white" : warrantyStatus == "expiring" ? "bg-warning text-dark" : "bg-success text-white")">
                    <h5 class="mb-0"><i class="bi bi-shield-check me-2"></i>Warranty Information</h5>
                </div>
                <div class="card-body">
                    @if (Model.WarrantyExpirationDate.HasValue)
                    {
                        <div class="text-center mb-3">
                            @if (warrantyStatus == "expired")
                            {
                                <div class="alert alert-danger mb-0">
                                    <i class="bi bi-x-circle fs-4"></i>
                                    <div class="mt-2">
                                        <strong>Warranty Expired</strong>
                                        <div class="small">Expired @Math.Abs(warrantyDaysLeft) days ago</div>
                                    </div>
                                </div>
                            }
                            else if (warrantyStatus == "expiring")
                            {
                                <div class="alert alert-warning mb-0">
                                    <i class="bi bi-exclamation-triangle fs-4"></i>
                                    <div class="mt-2">
                                        <strong>Warranty Expiring Soon</strong>
                                        <div class="small">@warrantyDaysLeft days remaining</div>
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div class="alert alert-success mb-0">
                                    <i class="bi bi-shield-check fs-4"></i>
                                    <div class="mt-2">
                                        <strong>Warranty Active</strong>
                                        <div class="small">@warrantyDaysLeft days remaining</div>
                                    </div>
                                </div>
                            }
                        </div>
                        <dl class="row mb-0">
                            <dt class="col-sm-5 text-muted">Expiration Date</dt>
                            <dd class="col-sm-7 fw-semibold">
                                <i class="bi bi-calendar-x me-1"></i>@Model.WarrantyExpirationDate.Value.ToString("MMMM dd, yyyy")
                            </dd>
                        </dl>
                    }
                    else
                    {
                        <div class="text-center text-muted">
                            <i class="bi bi-info-circle fs-3"></i>
                            <p class="mt-2 mb-0">No warranty information available</p>
                        </div>
                    }
                </div>
            </div>

            <!-- Location & Status -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0"><i class="bi bi-geo-alt me-2"></i>Location & Status</h5>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-5 text-muted">Location</dt>
                        <dd class="col-sm-7">
                            <i class="bi bi-pin-map-fill me-1 text-danger"></i>
                            <strong>@(Model.Location ?? "Not assigned")</strong>
                        </dd>

                        <dt class="col-sm-5 text-muted">Current Status</dt>
                        <dd class="col-sm-7">
                            <span class="badge @statusBadge">@Model.Status?.Name</span>
                        </dd>

                        <dt class="col-sm-5 text-muted">Assigned User</dt>
                        <dd class="col-sm-7">
                            <i class="bi bi-person-circle me-1"></i>@(Model.UserName ?? "Unassigned")
                        </dd>
                    </dl>
                </div>
            </div>

            <!-- Audit Trail -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i>Audit Trail</h5>
                </div>
                <div class="card-body">
                    <div class="timeline">
                        <div class="timeline-item mb-3">
                            <div class="d-flex">
                                <div class="timeline-marker bg-success rounded-circle me-3" style="width: 10px; height: 10px; margin-top: 6px;"></div>
                                <div class="flex-grow-1">
                                    <div class="small text-muted">Created</div>
                                    <div class="fw-semibold">@Model.CreatedAt.ToString("MMM dd, yyyy 'at' hh:mm tt")</div>
                                    <div class="small text-muted">by @Model.CreatedBy</div>
                                </div>
                            </div>
                        </div>
                        @if (Model.UpdatedAt.HasValue)
                        {
                            <div class="timeline-item">
                                <div class="d-flex">
                                    <div class="timeline-marker bg-info rounded-circle me-3" style="width: 10px; height: 10px; margin-top: 6px;"></div>
                                    <div class="flex-grow-1">
                                        <div class="small text-muted">Last Updated</div>
                                        <div class="fw-semibold">@Model.UpdatedAt.Value.ToString("MMM dd, yyyy 'at' hh:mm tt")</div>
                                        <div class="small text-muted">by @Model.UpdatedBy</div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="card border-0 shadow-sm">
        <div class="card-body">
            <h5 class="card-title mb-3"><i class="bi bi-lightning me-2"></i>Quick Actions</h5>
            <div class="d-flex flex-wrap gap-2">
                <a asp-action="Edit" asp-route-id="@Model.AssetID" class="btn btn-primary">
                    <i class="bi bi-pencil me-1"></i>Edit Asset
                </a>
                <button class="btn btn-outline-secondary" onclick="window.print()">
                    <i class="bi bi-printer me-1"></i>Print Details
                </button>
                <button class="btn btn-outline-info" onclick="exportToJson()">
                    <i class="bi bi-download me-1"></i>Export Data
                </button>
                <a asp-action="Index" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left me-1"></i>Back to List
                </a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <style>
        .card {
            transition: transform 0.2s;
        }

            .card:hover {
                transform: translateY(-2px);
            }

        dl.row dt {
            font-weight: 500;
        }

        dl.row dd {
            margin-bottom: 0.5rem;
        }

        .spec-item {
            text-align: center;
        }

        .timeline-marker {
            flex-shrink: 0;
        }

        media print {
            .btn, nav, .card-header

        {
            display: none !important;
        }

        }
    </style>

    <script>
        function exportToJson() {
            const assetData = {
                computerName: '@Model.ComputerName',
                userName: '@Model.UserName',
                serialNumber: '@Model.SerialNumber',
                manufacturer: '@Model.Manufacturer',
                model: '@Model.Model',
                processor: '@Model.Processor',
                ram: '@Model.RAM',
                storage: '@Model.Storage',
                os: '@Model.OS',
                location: '@Model.Location',
                purchaseDate: '@Model.PurchaseDate',
                purchasePrice: '@Model.PurchasePrice',
                warrantyExpiration: '@Model.WarrantyExpirationDate'
            };

            const dataStr = JSON.stringify(assetData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'asset_@Model.ComputerName';
            link.click();
        }
    </script>
}